#
# Key Bindings.
# 

# Generic.
# The generic menu is not a real menu, but specifies common functions (such as
# movement) available in all menus except for pager and editor. Changing
# settings for this menu will affect the default bindings for all menus (except
# as noted).

# termcap is terribly wrong sometimes....
macro generic \r     <Enter>
macro generic \e[A   <Up>
macro generic \e[B   <Down>
macro generic \e[C   <Right>
macro generic \e[D   <Left>
macro generic \e[1~  <Home>
macro generic \e[4~  <End>
macro generic \e[5~  <PageUp>
macro generic \e[6~  <PageDown>
macro generic \eOP   <F1>
macro generic \eOQ   <F2>
macro generic \eOR   <F3>
macro generic \eOS   <F4>

bind generic "g"     first-entry
bind generic "G"     last-entry
bind generic <home>  first-entry
bind generic <end>   last-entry
bind generic <left>  previous-entry
bind generic <right> next-entry

# You need the "noop" bind so that the line editor accepts IMAP folders with
# spaces in their names. 
bind editor <space> noop

bind index,pager  "["     previous-thread
bind index,pager  "]"     next-thread
bind index,pager  "{"     previous-subthread
bind index,pager  "}"     next-subthread
bind index,pager  ",g"    group-reply
bind index,pager  "\Cp"   half-up
bind index,pager  "\Cn"   half-down

bind index  "h"     noop
bind index  "z"     noop
bind index  "Z"     noop
bind index  "g"     first-entry
bind index  "G"     last-entry
bind index  ",z"    collapse-thread 
bind index  ",Z"    collapse-all
bind index  "zt"    current-top
bind index  "zb"    current-bottom
bind index  "zz"    current-middle

bind pager  "g"     top
bind pager  "G"     bottom
bind pager  <home>  top
bind pager  <end>   bottom
bind pager  "\Cf"   next-page
bind pager  "\Cb"   previous-page
bind pager  "\Cj"   next-line
bind pager  "\Ck"   previous-line
bind pager  <up>    previous-line
bind pager  <down>  next-line
bind pager  <left>  previous-undeleted
bind pager  <right> next-undeleted


#
# Macros.
# 

macro index,pager ",<F5>"   "<enter-command>source ~/.muttrc<enter>"             "Reload .muttrc"
macro index,pager ",v"      "<pipe-message>vim +':set ft=mail' - <enter>"        "View the message in vim"
macro index,pager ",V"      "<pipe-message>mvim +':set ft=mail' - <enter>"       "View the message in MacVim"
macro index,pager "\'"      "<clear-flag>r"                                      "Mark as un-replied"

macro index       ",r"      "<read-thread><previous-undeleted><next-new-then-unread>" "Mark current thread as read and go to next unread message"
macro index       ",R"      "<tag-pattern>~U<enter><clear-flag>N<clear-flag>*"   "Catch up (mark all as read)"
macro index       ",n"      "<limit>~N<enter>"                                   "Limit display to new mail"
macro index       ",u"      "<limit>~U<enter>"                                   "Limit display to unread mail"
macro index       ",a"      "<limit>all<enter>"                                  "Reset disply limit to all mail"

macro pager       "w"       "<enter-command>set invsmart_wrap invmarkers<enter>" "Toggle wrap stuff"
macro pager       "\e1"     "<enter-command>set pager_index_lines=1<enter>"      "Set pager lines to 1"
macro pager       "\e2"     "<enter-command>set pager_index_lines=2<enter>"      "Set pager liens to 2"
macro pager       "\e3"     "<enter-command>set pager_index_lines=3<enter>"      "Set pager liens to 3"
macro pager       "\e4"     "<enter-command>set pager_index_lines=4<enter>"      "Set pager liens to 4"
macro pager       "\e5"     "<enter-command>set pager_index_lines=5<enter>"      "Set pager liens to 5"
macro pager       "\e6"     "<enter-command>set pager_index_lines=6<enter>"      "Set pager liens to 6"
macro pager       "\e7"     "<enter-command>set pager_index_lines=7<enter>"      "Set pager liens to 7"
macro pager       "\e8"     "<enter-command>set pager_index_lines=8<enter>"      "Set pager liens to 8"
macro pager       "\e9"     "<enter-command>set pager_index_lines=9<enter>"      "Set pager liens to 9"
macro pager       "\e0"     "<enter-command>set pager_index_lines=0<enter>"      "Set pager liens to 0"
macro pager       ",s"      "<pipe-message>lbdb-fetchaddr<enter>"                "Store address details in lbdb"
macro pager       "H"       "<pipe-message>mailhops<enter>"                      "View the path of the mail"
macro pager       ",r"      "<enter-command>set display_filter = \"tr a-zA-Z n-za-mN-ZA-M\"<enter><exit><display-message><enter-command>unset display_filter<enter>" "ROT13 display filter"
macro pager       ",p"      "<pipe-entry>gpg --keyserver search.keyserver.net --recv-key <enter>"  "Get PGP key"
macro pager       "\cu"     "<pipe-entry>'urlview'<enter>"                       "Follow links with urlview"

# Mairix search
macro generic ",/" "<enter-command>set my_search = \`~/.mutt/scripts/mutt-mairix.sh\`<return><enter-command>push \$my_search<return>"

# GMail
folder-hook .   'bind  index,pager "y"   noop'
folder-hook "!" 'macro index,pager "y"  "<delete-message>"                  "Remove INBOX label, i.e. archive"'
macro index,pager "d"       "<save-message>+[Gmail].Trash<enter><enter>"    "Trash"
macro index,pager "S"       "<save-message>=[Gmail].Spam<enter>"            "Mark message as spam"
macro index,pager ",h"      "<save-message>!<enter>"                        "Mark message as ham"
macro index,pager "I"       "<change-folder>!<enter>"

# vim: ft=muttrc
