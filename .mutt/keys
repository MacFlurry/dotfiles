#
# Key Bindings.
# 

# You need the "noop" bind so that the line editor accepts IMAP folders with
# spaces in their names. 
bind editor <space> noop

# Generic.
# The generic menu is not a real menu, but specifies common functions (such as
# movement) available in all menus except for pager and editor. Changing
# settings for this menu will affect the default bindings for all menus (except
# as noted).

# termcap is terribly wrong sometimes....
macro generic \r          <Enter>
macro generic \e[A        <Up>
macro generic \e[B        <Down>
macro generic \e[C        <Right>
macro generic \e[D        <Left>
macro generic \e[1~       <Home>
macro generic \e[4~       <End>
macro generic \e[5~       <PageUp>
macro generic \e[6~       <PageDown>
macro generic \eOP        <F1>
macro generic \eOQ        <F2>
macro generic \eOR        <F3>
macro generic \eOS        <F4>

# Movements.
bind index,pager,generic \cp    half-up
bind index,pager,generic \cn    half-down
bind index,pager,generic [      half-up
bind index,pager,generic ]      half-down
bind index,pager,generic k      previous-entry
bind index,pager,generic j      next-entry
bind index,pager <left>         previous-undeleted
bind index,pager <right>        next-undeleted
bind index,generic <home>       first-entry
bind index,generic <end>        last-entry
bind index,generic g            noop
bind index,generic gg           first-entry
bind index,generic G            last-entry
bind index,generic H            top-page
bind index,generic M            middle-page
bind index,generic L            bottom-page
bind index,generic z            noop
bind index,generic zt           current-top
bind index,generic zb           current-bottom
bind index,generic zz           current-middle

bind pager g                    noop
bind pager gg                   top
bind pager <home>               top
bind pager G                    bottom
bind pager <end>                bottom
bind pager \cf                  next-page
bind pager \cb                  previous-page
bind pager \cj                  next-line
bind pager <down>               next-line
bind pager \ck                  previous-line
bind pager <up>                 previous-line

# Thread handling.
bind index zo             collapse-thread 
bind index zc             collapse-thread 
bind index zM             collapse-all
bind index zR             collapse-all
bind index,pager {        previous-thread
bind index,pager }        next-thread
macro index,pager R       "<read-thread><previous-undeleted><next-new-then-unread>" "Mark current thread as read and go to next unread message"

# Message handling
bind index,pager  ,R       recall-message
bind index,pager  ,r       group-reply
macro index,pager  *       <tag-message>                                           "Tag message"
macro index       ,c      "<tag-pattern>~U<enter><clear-flag>N<clear-flag>*"      "Catch up (mark all as read)"
macro index,pager ,v      "<pipe-message>vim +':set ft=mail' - <enter>"           "View the message in vim"
macro index,pager ,V      "<pipe-message>mvim +':set ft=mail' - <enter>"          "View the message in MacVim"
macro index,pager \'      "<clear-flag>r"                                         "Mark as un-replied"


#
# Macros.
# 

# Mairix search
macro generic     ",/"      "<enter-command>set my_search = \`~/.mutt/scripts/mutt-mairix.sh\`<return><enter-command>push \$my_search<return>"

macro generic     ",<F5>"   "<enter-command>source ~/.muttrc<enter>"                "Reload .muttrc"
macro index       ",n"      "<limit>~N<enter>"                                      "Limit display to new mail"
macro index       ",u"      "<limit>~U<enter>"                                      "Limit display to unread mail"
macro index       ",a"      "<limit>all<enter>"                                     "Reset disply limit to all mail"
macro pager       ",s"      "<pipe-message>lbdb-fetchaddr<enter>"                   "Store address details in lbdb"
macro pager       ",p"      "<pipe-entry>gpg --keyserver search.keyserver.net --recv-key <enter>"  "Get PGP key"
macro pager       "\cu"     "<pipe-entry>urlview<enter>"                            "Follow links with urlview"
macro pager       ",f"      "<enter-command>set display_filter=~/.mutt/scripts/message-format.pl<enter><exit><display-message><enter-command>unset display_filter<enter>" "Pretty-print message via par"

macro pager       "w"       "<enter-command>set invsmart_wrap invmarkers<enter>"    "Toggle wrap stuff"
macro pager       "\e1"     "<enter-command>set pager_index_lines=1<enter>"         "Set pager lines to 1"
macro pager       "\e2"     "<enter-command>set pager_index_lines=2<enter>"         "Set pager liens to 2"
macro pager       "\e3"     "<enter-command>set pager_index_lines=3<enter>"         "Set pager liens to 3"
macro pager       "\e4"     "<enter-command>set pager_index_lines=4<enter>"         "Set pager liens to 4"
macro pager       "\e5"     "<enter-command>set pager_index_lines=5<enter>"         "Set pager liens to 5"
macro pager       "\e6"     "<enter-command>set pager_index_lines=6<enter>"         "Set pager liens to 6"
macro pager       "\e7"     "<enter-command>set pager_index_lines=7<enter>"         "Set pager liens to 7"
macro pager       "\e8"     "<enter-command>set pager_index_lines=8<enter>"         "Set pager liens to 8"
macro pager       "\e9"     "<enter-command>set pager_index_lines=9<enter>"         "Set pager liens to 9"
macro pager       "\e0"     "<enter-command>set pager_index_lines=0<enter>"         "Set pager liens to 0"

#
# GMail
# 

# Archiving only in INBOX.
folder-hook .           'bind  index,pager "y"   noop'
folder-hook "!"         'macro index,pager "y" "<delete-message>"                   "Remove INBOX label, i.e., archive message"'

# Trash management.
folder-hook .           'macro index,pager "d" "<save-message>=trash<enter><enter>" "Move message to trash"'
folder-hook "=trash"    'bind index,pager "d" delete-message'

macro index,pager "I"       "<change-folder>!<enter>"                               "Go to INBOX"
macro index,pager "H"       "<save-message>!<enter>"                                "Mark message as ham"
macro index,pager "S"       "<save-message>=spam<enter>"                            "Mark message as spam"

# vim: ft=muttrc
