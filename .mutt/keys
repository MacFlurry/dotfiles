#
# Navigation
#

bind generic      g    noop
bind generic      gg   first-entry
bind generic      G    last-entry
bind index,pager  gf   change-folder
macro index,pager gi  "<change-folder>!<enter>" "go to INBOX"
macro index,pager gp  <change-folder>!!<enter> "go to previous mailbox"
macro index,pager ga  <change-folder>=archive<enter> "go to ARCHIVE"
macro index,pager gs  <change-folder>=sent<enter> "go to SENT"
macro index,pager gS  <change-folder>=spam<enter> "go to SPAM"
macro index,pager gt  <change-folder>=trash<enter> "go to SENT"
bind index,pager  gd  recall-message    # [g]o to [d]rafts
macro index,pager gl  <change-folder>?<toggle-mailboxes>/ "go to LABEL"
macro index,pager gv  "<pipe-message>vim +':set ft=mail' - <enter>"  "view the message in vim"
macro index,pager gV  "<pipe-message>mvim +':set ft=mail' - <enter>" "view the message in MacVim"
macro generic     g/  "<enter-command>set my_search = \`~/.mutt/scripts/mutt-mairix.sh\`<return><enter-command>push \$my_search<return>"

bind generic      ,   noop
macro generic     ,r  "<enter-command>source ~/.muttrc<enter>"       "Reload .muttrc"
macro generic     ,o  "<shell-escape>offlineimap -qof INBOX<enter>"  "run offlineimap to sync INBOX"
macro generic     ,O  "<shell-escape>offlineimap -o<enter>"          "run offlineimap to sync all mail"
macro pager       ,u  "<pipe-entry>urlview<enter>"                   "extract links with urlview"
macro pager       \cu "<pipe-entry>urlview<enter>"                   "extract links with urlview"
macro pager       ,a  "<pipe-message>lbdb-fetchaddr<enter>"          "Store address details in lbdb"
macro pager       ,p  "<pipe-entry>gpg --keyserver search.keyserver.net --recv-key <enter>"  "Get PGP key"

# Folding
bind index        z    noop
bind index        zo   collapse-thread
bind index        zc   collapse-thread
bind index        zM   collapse-all
bind index        zR   collapse-all

# Movement
bind index        h   previous-thread
bind pager        h   previous-line
bind index        l   next-thread
bind pager        l   next-line
bind index        gg  first-entry
bind pager        gg  top
bind index        G   last-entry
bind pager        G   bottom
bind index,pager  [   half-up
bind index,pager  ]   half-down
bind index,pager  p   previous-page
bind index,pager  n   next-page
bind index,pager  \;  next-new
macro index,pager \'  <read-thread><previous-undeleted><next-new-then-unread> "Mark current thread as read and go to next unread message"

bind pager        H   display-toggle-weed   # toggle display of full headers
macro pager       -  "<enter-command>set display_filter=~/.mutt/scripts/message-format.pl<enter><exit><display-message><enter-command>unset display_filter<enter>" "Pretty-print message via par"
macro pager       w   "<enter-command>set invsmart_wrap invmarkers<enter>"    "Toggle wrap stuff"

#
# Message selection and views
#

bind index        T   tag-thread
bind index,pager  x   noop
macro index,pager xx  <untag-pattern>~A<enter> "clear selection"
macro index,pager xa  <tag-pattern>~A<enter>   "select all"
macro index,pager xu  <tag-pattern>~U<enter>   "select all unread"
macro index,pager xr  <tag-pattern>!~U<enter>  "select all read"
macro index,pager xd  <tag-pattern>~D<enter>   "select all deleted"
macro index,pager xq  <tag-pattern>~Q<enter>   "select all replied"
macro index,pager xp  <tag-pattern>~p<enter>   "select all to me (personal)"
macro index,pager xs  <tag-pattern>~F<enter>   "select all starred/flagged"
bind index        xt  tag-pattern
bind index        L   noop
bind index        Lt  limit
macro index       Ln  <limit>~N<enter>   "Limit display to new mail"
macro index       Lu  <limit>~U<enter>   "Limit display to unread mail"
macro index       Ld  <limit>~D<enter>   "Limit display to deleted mail"
macro index       Lp  <limit>~D<enter>   "Limit display to personal mail"
macro index       Ls  <limit>~F<enter>   "Limit display to starred/flagged mail"
macro index       Ll  <limit>all<enter>  "Reset disply limit to all mail"
macro index       LL  <limit>all<enter>  "Reset disply limit to all mail"

#
# Message handling
#

bind index,pager  s   flag-message  # [s]tar message
bind index,pager  P   print-message
macro index,pager S   <save-message>=spam<enter>         "mark message as spam"
macro index,pager a   <save-message>?<toggle-mailboxes>/ "move message to a mailbox"
macro index,pager c   <copy-message>?<toggle-mailboxes>/ "copy message to a mailbox"
macro index,pager I   <tag-pattern>~U<enter><clear-flag>N<clear-flag>* "mark all as read ([i]gnore)"
macro index,pager xU  <tag-pattern>~U<enter><clear-flag>N<clear-flag>* "mark all read as unread"
macro index,pager xD  <tag-pattern>~D<enter><clear-flag>D<clear-flag>* "undelete all items"

# This rather complicated macro sequence places the signature on top when
# forwarding a message and leaves at the bottom for all other commands that
# compose a message. Unfortunately we also need a second signature with an
# extra newline at the bottom, the forwarded mail does not contain a newline
# between the last line of the signature and the following forwarded message.
# (If my signature did not consist only of my first name, I probably simply
# drop it when forwarding mails.)
macro index,pager f   ":set sig_on_top<enter>:set signature=~/.mutt/signature.forward<enter><forward-message>" "forward message"
macro index,pager R   ":unset sig_on_top<enter>:set signature=~/.mutt/signature<enter><reply>" "reply to message"
macro index,pager r   ":unset sig_on_top<enter>:set signature=~/.mutt/signature<enter><group-reply>" "group-reply to message"
macro index,pager m   ":unset sig_on_top<enter>:set signature=~/.mutt/signature<enter><mail>" "compose message"

# Gmail delete: if we're not in the trash folder, move the messsage there.
# Otherwise do nothing.
folder-hook .        'macro index,pager d <save-message>=trash<enter> "move message to trash"'
folder-hook "=trash" 'bind index,pager d noop'

# GMail archive: remove INBOX label, but only when we're in the INBOX.
#folder-hook .        'bind index,pager  y noop'
folder-hook "!"      'macro index,pager y <delete-message> "archive message, i.e., remove INBOX label"'

#
# Misc
#

bind editor   <space>   noop # Accepts IMAP folder names with spaces.

bind attach   <return>  view-mailcap # View attachments properly.
bind attach   i         exit # consistent with pager

# vim: ft=muttrc
